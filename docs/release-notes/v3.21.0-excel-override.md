# GenoMAX² Release Notes  
## v3.21.0 – Excel Override Engine & Batch-Aware QA

**Release Date:** 2026-01-06  
**Scope:** Data Integrity, Catalog Override, QA Infrastructure  
**Status:** Deployed to Production

---

## Overview

This release introduces a major infrastructure milestone for GenoMAX²:

A fully deterministic **Excel Override Engine** combined with **batch-aware QA verification**, enabling verifiable alignment between curated catalog data and the production database.

This release removes hardcoded comparisons, introduces payload snapshots per batch, and separates DB integrity from design readiness.

---

## What's Live

### Excel Override Engine (Option D)
- Ingredient-level Excel input normalized to **module-level payload**
- Explicit primary ingredient selection for classification
- Aggregation of safety notes, contraindications, and evidence across ingredients
- Deterministic override execution with full audit trail

### Batch-Aware Payload Snapshot
- Payload used during execution is persisted per batch
- Enables deterministic QA: same batch → same result
- Supports historical verification and debugging

### Batch-Aware QA Compare
- DB is compared against the **exact payload snapshot used for override**
- No hardcoded Excel data
- Deterministic and reproducible
- Mathematical invariants enforced (coverage + alignment)

### QA Audit Split
QA is now explicitly split into two modes:

#### 1. DB Integrity Audit (Expected to PASS)
- Schema validation
- Uniqueness constraints
- Environment validity
- Structural consistency

#### 2. READY_FOR_DESIGN Audit (Expected to FAIL for now)
- Requires supplier-driven fields and clean label copy
- Blocks design export until all gates are satisfied

---

## New / Updated API Endpoints

### Catalog Override
- `GET /api/v1/catalog/override/migrate`
- `GET /api/v1/catalog/override/batches`
- `GET /api/v1/catalog/override/payload/{batch_id}`

### QA Compare
- `GET /api/v1/qa/compare/batch/{batch_id}`
- `GET /api/v1/qa/compare/latest-batch`

### QA Audit
- `GET /api/v1/qa/audit/os-modules/integrity`
- `GET /api/v1/qa/audit/os-modules/design`

---

## Verification – Latest Batch

**Batch ID:** `d772c871-b110-4f76-aa75-ccd7a37af542`

### Alignment
- Payload records: 78  
- Attempted: 63  
- Excluded: 15  
- Matched in DB: 63  
- Not found in DB: 0  
- Total field diffs: 0  

**Result:**  
✅ DB is 100% aligned with override payload for all authoritative fields

### Invariants (PASS)
- attempted + excluded = payload_records  
- matched_in_db + not_found_in_db = attempted  

### Audits
- DB Integrity Audit: ✅ PASS  
- READY_FOR_DESIGN Audit: ❌ FAIL (expected)

---

## Known Limitations (Intentional)

The following are **not bugs** and are intentionally blocking design export:

- `net_quantity` not populated (awaiting Supliful API)
- `fda_disclaimer` not populated for all modules
- Placeholders still exist in some label text fields

As a result:
- `READY_FOR_DESIGN` export is currently empty
- Design work should proceed on templates only, not final product files

---

## What This Unlocks

- Safe, auditable catalog overrides
- Deterministic QA with mathematical guarantees
- Clear separation between data correctness and design readiness
- Foundation for supplier API ingestion and automated design export

---

## Next Gates

1. Integrate Supliful Catalog API (SKU → quantity, link, disclaimer)
2. Populate supplier-driven fields (`net_quantity`, `product_link`, `fda_disclaimer`)
3. Clean remaining placeholders in label copy
4. Unlock `READY_FOR_DESIGN` export for label designers
5. Extend Design Export to include Web Copy (Shopify title/body)

---

## Summary

This release establishes a hardened, audit-grade data pipeline for GenoMAX².  
Catalog data can now be overridden, verified, and explained with full traceability.

Design export will be enabled once supplier data and content completeness gates are satisfied.
